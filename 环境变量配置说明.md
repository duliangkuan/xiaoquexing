# 环境变量配置说明 🔐

## ✅ 部署状态

项目已成功部署到 Vercel！

**生产环境URL**：https://liwu-rd0ii2mkx-duliangkuans-projects.vercel.app

## ⚠️ 重要：需要配置环境变量

部署已完成，但**必须配置环境变量**网站才能正常工作（特别是邮件功能）。

### 🗄️ 数据库配置（必需）

**重要**：在 Vercel 的 serverless 环境中，必须配置 MongoDB 数据库才能持久化存储数据。如果不配置数据库，保存的日记数据会丢失。

📖 **详细配置步骤请参考**：[Vercel数据库配置指南.md](./Vercel数据库配置指南.md)

**快速配置**：
1. 创建 MongoDB Atlas 免费账户：https://www.mongodb.com/cloud/atlas
2. 创建免费集群并获取连接字符串
3. 在 Vercel 环境变量中添加 `MONGODB_URI`

## 📝 方法一：在 Vercel 网站上配置（推荐）

1. **访问 Vercel 项目设置**
   - 登录 https://vercel.com
   - 进入项目：https://vercel.com/duliangkuans-projects/liwu/settings
   - 点击左侧菜单 "Environment Variables"

2. **添加以下环境变量**

   每个变量需要分别添加到三个环境（Production、Preview、Development）：

   | 变量名 | 值 | 环境 |
   |--------|-----|------|
   | `DIARY_PASSWORD` | `admin888888` | Production, Preview, Development |
   | `SMTP_HOST` | `smtp.qq.com` | Production, Preview, Development |
   | `SMTP_PORT` | `465` | Production, Preview, Development |
   | `SMTP_USER` | `2330304961@qq.com` | Production, Preview, Development |
   | `SMTP_PASS` | `bwzqgvsfgehwdjde` | Production, Preview, Development |
   | `RECIPIENT_EMAIL` | `2330304961@qq.com` | Production, Preview, Development |

   **必需**（数据库配置，否则数据无法持久化）：
   | 变量名 | 值 | 环境 | 说明 |
   |--------|-----|------|------|
   | `MONGODB_URI` | `mongodb+srv://用户名:密码@集群地址/xiaokuixing_diary?retryWrites=true&w=majority` | Production, Preview, Development | MongoDB 连接字符串，详见 [数据库配置指南](./Vercel数据库配置指南.md) |

3. **保存并重新部署**
   - 添加完所有变量后，点击 "Save"
   - 返回项目页面
   - 点击 "Redeploy" 重新部署

## 📝 方法二：使用 Vercel CLI（交互式）

在项目目录运行以下命令，会交互式地询问每个值：

```bash
cd C:\Users\23303\OneDrive\Desktop\liwu

# 添加环境变量（会交互式询问值）
vercel env add DIARY_PASSWORD production
vercel env add SMTP_HOST production
vercel env add SMTP_PORT production
vercel env add SMTP_USER production
vercel env add SMTP_PASS production
vercel env add RECIPIENT_EMAIL production
```

**注意**：每个命令需要分别添加到三个环境：
- `production` - 生产环境
- `preview` - 预览环境
- `development` - 开发环境

例如：
```bash
vercel env add DIARY_PASSWORD production
# 输入值：admin888888
vercel env add DIARY_PASSWORD preview
# 输入值：admin888888
vercel env add DIARY_PASSWORD development
# 输入值：admin888888
```

## 🔄 重新部署

配置完环境变量后，需要重新部署：

```bash
vercel --prod
```

或者：
- 在 Vercel 网站上点击 "Redeploy"
- 或推送新的代码到 GitHub（会自动触发部署）

## ✅ 验证部署

配置环境变量并重新部署后，测试以下功能：

1. **访问网站**：https://liwu-rd0ii2mkx-duliangkuans-projects.vercel.app
2. **保存日记**：在中央编辑区输入内容，点击"保存小确幸"
3. **查看历史**：点击右上角日历图标，输入密码 `admin888888`
4. **树洞倾诉**：点击右下角漂流瓶按钮，输入内容，点击"倾诉"，检查邮箱是否收到邮件

## 🐛 故障排查

如果功能不工作，检查：

1. **环境变量是否正确配置**
   - 在 Vercel 项目设置中查看 Environment Variables
   - 确保所有必需变量都已添加

2. **是否重新部署**
   - 添加环境变量后必须重新部署

3. **查看部署日志**
   ```bash
   vercel logs --follow
   ```

## 📚 相关文档

- 📖 [Vercel数据库配置指南](./Vercel数据库配置指南.md) - **详细数据库配置步骤**
- Vercel 环境变量文档：https://vercel.com/docs/concepts/projects/environment-variables
- 项目设置：https://vercel.com/duliangkuans-projects/liwu/settings
- MongoDB Atlas：https://www.mongodb.com/cloud/atlas

