# 环境变量完整清单 📋

## 需要在Vercel上手动添加的所有环境变量

### 访问配置页面

打开浏览器，访问：
**https://vercel.com/duliangkuans-projects/liwu/settings/environment-variables**

## 📝 必须添加的环境变量

### 1. SMTP邮件配置（用于树洞倾诉邮件发送）

#### ① SMTP_HOST
- **变量名**: `SMTP_HOST`
- **值**: `smtp.qq.com`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: QQ邮箱SMTP服务器地址

#### ② SMTP_PORT
- **变量名**: `SMTP_PORT`
- **值**: `465`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: SMTP端口（465使用SSL）

#### ③ SMTP_USER
- **变量名**: `SMTP_USER`
- **值**: `2330304961@qq.com`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: 发件人QQ邮箱地址

#### ④ SMTP_PASS
- **变量名**: `SMTP_PASS`
- **值**: `bwzqgvsfgehwdjde`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: QQ邮箱授权码（不是登录密码）

#### ⑤ RECIPIENT_EMAIL
- **变量名**: `RECIPIENT_EMAIL`
- **值**: `2330304961@qq.com`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: 收件人邮箱地址（树洞倾诉发送到的邮箱）

### 2. 数据库配置（用于保存日记）

#### ⑥ MONGODB_URI（可选，但推荐）
- **变量名**: `MONGODB_URI`
- **值**: `mongodb+srv://用户名:密码@集群地址/xiaokuixing_diary?retryWrites=true&w=majority`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: MongoDB Atlas连接字符串
- **注意**: 如果通过Vercel数据库集成连接，可能是 `MONGODB_URL` 或 `STORAGE_URL`

### 3. 系统配置

#### ⑦ DIARY_PASSWORD
- **变量名**: `DIARY_PASSWORD`
- **值**: `admin888888`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: 查看历史日记的密码

#### ⑧ DB_NAME（可选）
- **变量名**: `DB_NAME`
- **值**: `xiaokuixing_diary`
- **环境**: ☑️ Production  ☑️ Preview  ☑️ Development
- **说明**: 数据库名称（如果MongoDB URI中没有指定）

## 📋 完整变量清单（复制用）

### Production、Preview、Development 都需要添加：

```
SMTP_HOST=smtp.qq.com
SMTP_PORT=465
SMTP_USER=2330304961@qq.com
SMTP_PASS=bwzqgvsfgehwdjde
RECIPIENT_EMAIL=2330304961@qq.com
DIARY_PASSWORD=admin888888
DB_NAME=xiaokuixing_diary
```

**MONGODB_URI** 需要从MongoDB Atlas获取，或如果已通过Vercel数据库集成连接，会自动创建。

## 🔧 手动添加步骤（详细）

### 步骤1：访问环境变量设置页面

1. 打开浏览器
2. 访问：**https://vercel.com/duliangkuans-projects/liwu/settings/environment-variables**
3. 登录您的Vercel账号

### 步骤2：添加每个环境变量

对于**每个**变量，都需要：

1. 点击 **"Add New"** 按钮
2. 填写：
   - **Key（变量名）**: 输入变量名（如 `SMTP_HOST`）
   - **Value（值）**: 输入对应的值（如 `smtp.qq.com`）
   - **Environments（环境）**: 
     - ☑️ Production
     - ☑️ Preview
     - ☑️ Development
     - **全部勾选！**
3. 点击 **"Save"** 按钮
4. 重复上述步骤，添加所有变量

### 步骤3：添加所有7个必需变量

按照以下顺序添加：

1. **SMTP_HOST** = `smtp.qq.com`
2. **SMTP_PORT** = `465`
3. **SMTP_USER** = `2330304961@qq.com`
4. **SMTP_PASS** = `gbedglcqrgsydigi`
5. **RECIPIENT_EMAIL** = `2330304961@qq.com`
6. **DIARY_PASSWORD** = `admin888888`
7. **DB_NAME** = `xiaokuixing_diary`（可选）

**MONGODB_URI** - 如果已通过Vercel数据库集成连接，会自动创建，无需手动添加。

### 步骤4：验证配置

添加完所有变量后，页面应该显示：

```
✅ SMTP_HOST = smtp.qq.com (Production, Preview, Development)
✅ SMTP_PORT = 465 (Production, Preview, Development)
✅ SMTP_USER = 2330304961@qq.com (Production, Preview, Development)
✅ SMTP_PASS = *** (Production, Preview, Development)
✅ RECIPIENT_EMAIL = 2330304961@qq.com (Production, Preview, Development)
✅ DIARY_PASSWORD = *** (Production, Preview, Development)
✅ DB_NAME = xiaokuixing_diary (Production, Preview, Development)
✅ MONGODB_URI = *** (Production, Preview, Development) [如果已配置]
```

### 步骤5：重新部署

**重要**：配置完环境变量后，必须重新部署！

1. 返回项目页面：**https://vercel.com/duliangkuans-projects/liwu**
2. 点击 **"Redeploy"** 按钮
3. 选择最新的部署或直接重新部署
4. 等待部署完成（约2-3分钟）

## ⚠️ 重要提示

### 1. 每个环境都要配置

**必须**为以下三个环境都添加变量：
- ☑️ **Production**（生产环境）- 最重要！
- ☑️ **Preview**（预览环境）
- ☑️ **Development**（开发环境）

### 2. 授权码安全

- `SMTP_PASS` 的值是授权码：`gbedglcqrgsydigi`
- 这是敏感信息，Vercel会自动加密存储
- 不要在公开场合泄露

### 3. 配置后必须重新部署

- 环境变量只在新部署时生效
- 配置后必须重新部署才能使用
- 不重新部署，新配置的环境变量不会生效

### 4. 检查部署日志

如果邮件仍然发不出去，检查部署日志：
1. 访问：**https://vercel.com/duliangkuans-projects/liwu**
2. 点击最新的部署
3. 查看 "Function Logs"
4. 查找错误信息

## ✅ 验证配置

### 方法1：使用Vercel CLI检查

```bash
cd C:\Users\23303\OneDrive\Desktop\liwu
vercel env ls
```

应该能看到所有配置的变量。

### 方法2：测试邮件功能

部署完成后：

1. 访问网站
2. 点击右下角漂流瓶按钮
3. 输入测试内容
4. 点击"倾诉"按钮
5. 检查邮箱 `2330304961@qq.com` 是否收到邮件

### 方法3：查看服务器日志

如果邮件发送失败：
1. 在Vercel项目页面查看部署日志
2. 查找错误信息
3. 检查是否缺少环境变量

## 🐛 常见问题

### 问题1：环境变量没加载

**原因**：配置后没有重新部署

**解决**：
- 在Vercel项目页面点击 "Redeploy"
- 或推送代码到GitHub（自动部署）

### 问题2：邮件发不出去

**检查**：
1. 所有SMTP环境变量是否都已配置
2. 是否正确添加到所有环境（Production、Preview、Development）
3. 授权码是否正确
4. 是否已重新部署

### 问题3：环境变量值错误

**检查**：
- SMTP_HOST 应该是 `smtp.qq.com`
- SMTP_PORT 应该是 `465`
- SMTP_USER 应该是 `2330304961@qq.com`
- SMTP_PASS 应该是 `gbedglcqrgsydigi`（授权码）
- RECIPIENT_EMAIL 应该是 `2330304961@qq.com`

## 📝 快速参考

### 必需的环境变量（最小配置）

```
SMTP_HOST=smtp.qq.com
SMTP_PORT=465
SMTP_USER=2330304961@qq.com
SMTP_PASS=bwzqgvsfgehwdjde
RECIPIENT_EMAIL=2330304961@qq.com
DIARY_PASSWORD=admin888888
```

### 可选的环境变量

```
DB_NAME=xiaokuixing_diary
MONGODB_URI=mongodb+srv://...（如果手动配置）
```

## 🎉 完成！

配置完所有环境变量并重新部署后，邮件功能就能正常工作了！

如有问题，请查看部署日志或联系技术支持。

