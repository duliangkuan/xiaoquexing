# å®‰å…¨å¤´éƒ¨ä¿®å¤è¯´æ˜ ğŸ”’

## é—®é¢˜åˆ†æ

æµè§ˆå™¨å¼€å‘å·¥å…·æ˜¾ç¤ºä»¥ä¸‹å®‰å…¨è­¦å‘Šï¼š

### 1. Content Security Policy (CSP) é”™è¯¯
- **é—®é¢˜**ï¼šç½‘ç«™çš„èµ„æºè¢«CSPé˜»æ­¢
- **åŸå› **ï¼šæ²¡æœ‰é…ç½®Content Security Policyæˆ–é…ç½®ä¸å®Œæ•´
- **å½±å“**ï¼šå¯èƒ½å¯¼è‡´æŸäº›èµ„æºæ— æ³•åŠ è½½

### 2. HTTPå“åº”å¤´é—®é¢˜
- **é”™è¯¯**ï¼šç¼ºå°‘ `X-Content-Type-Options` å¤´éƒ¨ï¼ˆ24ä¸ªèµ„æºï¼‰
- **è­¦å‘Š**ï¼šä¸åº”åŒ…å« `X-Powered-By` å¤´éƒ¨ï¼ˆæš´éœ²æœåŠ¡å™¨ä¿¡æ¯ï¼‰
- **è­¦å‘Š**ï¼šä¸åº”ä½¿ç”¨ `Expires` å¤´éƒ¨ï¼Œåº”ä½¿ç”¨ `Cache-Control`
- **è­¦å‘Š**ï¼š`X-Frame-Options` åº”è¯¥è¢« CSP çš„ `frame-ancestors` æ›¿ä»£

## ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ å®‰å…¨å¤´éƒ¨ä¸­é—´ä»¶

åœ¨ `server.js` ä¸­æ·»åŠ å®‰å…¨å¤´éƒ¨ä¸­é—´ä»¶ï¼ˆç¬¬12-43è¡Œï¼‰ï¼š

```javascript
// å®‰å…¨å¤´éƒ¨ä¸­é—´ä»¶
app.use((req, res, next) => {
    // è®¾ç½®å®‰å…¨ç›¸å…³çš„HTTPå¤´éƒ¨
    res.setHeader('X-Content-Type-Options', 'nosniff'); // é˜²æ­¢MIMEç±»å‹å—…æ¢
    res.setHeader('X-Frame-Options', 'SAMEORIGIN'); // é˜²æ­¢ç‚¹å‡»åŠ«æŒ
    res.setHeader('X-XSS-Protection', '1; mode=block'); // XSSä¿æŠ¤
    res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin'); // æ¨èäººç­–ç•¥
    
    // è®¾ç½®Content Security Policy (CSP)
    const csp = [
        "default-src 'self'",
        "script-src 'self' 'unsafe-inline' 'unsafe-eval'",
        "style-src 'self' 'unsafe-inline'",
        "img-src 'self' data: https:",
        "font-src 'self' data:",
        "connect-src 'self' https://api.vercel.app",
        "frame-ancestors 'self'",
        "base-uri 'self'",
        "form-action 'self'",
        "object-src 'none'",
        "upgrade-insecure-requests"
    ].join('; ');
    res.setHeader('Content-Security-Policy', csp);
    
    // è®¾ç½®ç¼“å­˜æ§åˆ¶ï¼ˆæ›¿ä»£Expireså¤´éƒ¨ï¼‰
    res.setHeader('Cache-Control', 'public, max-age=3600');
    
    next();
});
```

### 2. éšè—X-Powered-Byå¤´éƒ¨

åœ¨ `server.js` ä¸­æ·»åŠ ï¼ˆç¬¬11è¡Œï¼‰ï¼š

```javascript
// éšè—Expressçš„x-powered-byå¤´éƒ¨
app.disable('x-powered-by');
```

### 3. åœ¨Vercelé…ç½®ä¸­æ·»åŠ å¤´éƒ¨

åœ¨ `vercel.json` ä¸­æ·»åŠ  `headers` é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºéƒ½åŒ…å«å®‰å…¨å¤´éƒ¨ï¼š

```json
"headers": [
    {
        "source": "/(.*)",
        "headers": [
            {
                "key": "X-Content-Type-Options",
                "value": "nosniff"
            },
            {
                "key": "Content-Security-Policy",
                "value": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://api.vercel.app; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; object-src 'none'; upgrade-insecure-requests"
            },
            {
                "key": "Cache-Control",
                "value": "public, max-age=3600"
            },
            {
                "key": "X-Powered-By",
                "value": ""
            }
        ]
    }
]
```

## ä¿®å¤çš„å®‰å…¨é—®é¢˜

### 1. X-Content-Type-Options
- **ä¿®å¤**ï¼šæ·»åŠ äº† `X-Content-Type-Options: nosniff`
- **ä½œç”¨**ï¼šé˜²æ­¢æµè§ˆå™¨MIMEç±»å‹å—…æ¢æ”»å‡»
- **ç»“æœ**ï¼šâœ… è§£å†³äº†24ä¸ªèµ„æºçš„é”™è¯¯

### 2. Content Security Policy (CSP)
- **ä¿®å¤**ï¼šé…ç½®äº†å®Œæ•´çš„CSPç­–ç•¥
- **ä½œç”¨**ï¼š
  - é˜²æ­¢XSSæ”»å‡»
  - æ§åˆ¶å…è®¸åŠ è½½çš„èµ„æº
  - é™åˆ¶è„šæœ¬æ‰§è¡Œ
- **ç»“æœ**ï¼šâœ… è§£å†³äº†CSPé”™è¯¯

### 3. X-Powered-By
- **ä¿®å¤**ï¼šç¦ç”¨äº†Expressçš„ `X-Powered-By` å¤´éƒ¨
- **ä½œç”¨**ï¼šéšè—æœåŠ¡å™¨æŠ€æœ¯æ ˆä¿¡æ¯
- **ç»“æœ**ï¼šâœ… è§£å†³äº†è­¦å‘Š

### 4. Cache-Control
- **ä¿®å¤**ï¼šä½¿ç”¨ `Cache-Control` æ›¿ä»£ `Expires`
- **ä½œç”¨**ï¼šæ›´ç°ä»£çš„ç¼“å­˜æ§åˆ¶æ–¹å¼
- **ç»“æœ**ï¼šâœ… è§£å†³äº†è­¦å‘Š

### 5. X-Frame-Options
- **ä¿®å¤**ï¼šä¿ç•™äº† `X-Frame-Options`ï¼ˆä¸ºäº†å…¼å®¹æ€§ï¼‰ï¼ŒåŒæ—¶ä½¿ç”¨CSPçš„ `frame-ancestors`
- **ä½œç”¨**ï¼šé˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»
- **ç»“æœ**ï¼šâœ… è§£å†³äº†è­¦å‘Š

## å®‰å…¨å¤´éƒ¨è¯´æ˜

### å·²æ·»åŠ çš„å¤´éƒ¨

1. **X-Content-Type-Options: nosniff**
   - é˜²æ­¢æµè§ˆå™¨MIMEç±»å‹å—…æ¢
   - ç¡®ä¿æµè§ˆå™¨æŒ‰ç…§Content-Typeå¤´éƒ¨è§£é‡Šå†…å®¹

2. **Content-Security-Policy**
   - æ§åˆ¶å…è®¸åŠ è½½çš„èµ„æº
   - é˜²æ­¢XSSæ”»å‡»
   - é™åˆ¶è„šæœ¬å’Œæ ·å¼æ¥æº

3. **X-Frame-Options: SAMEORIGIN**
   - é˜²æ­¢é¡µé¢è¢«åµŒå…¥åˆ°iframeä¸­ï¼ˆç‚¹å‡»åŠ«æŒä¿æŠ¤ï¼‰
   - ä¿ç•™ç”¨äºå…¼å®¹æ€§ï¼ŒåŒæ—¶ä½¿ç”¨CSPçš„ `frame-ancestors`

4. **X-XSS-Protection: 1; mode=block**
   - å¯ç”¨æµè§ˆå™¨çš„XSSä¿æŠ¤
   - æ£€æµ‹åˆ°XSSæ”»å‡»æ—¶é˜»æ­¢é¡µé¢åŠ è½½

5. **Referrer-Policy: strict-origin-when-cross-origin**
   - æ§åˆ¶æ¨èäººä¿¡æ¯çš„å‘é€
   - ä¿æŠ¤ç”¨æˆ·éšç§

6. **Cache-Control: public, max-age=3600**
   - æ§åˆ¶èµ„æºç¼“å­˜
   - æ›¿ä»£è¿‡æ—¶çš„ `Expires` å¤´éƒ¨

## Content Security Policy (CSP) é…ç½®

### CSPæŒ‡ä»¤è¯´æ˜

- `default-src 'self'`ï¼šé»˜è®¤åªå…è®¸åŒæºèµ„æº
- `script-src 'self' 'unsafe-inline' 'unsafe-eval'`ï¼šå…è®¸åŒæºè„šæœ¬ã€å†…è”è„šæœ¬å’Œevalï¼ˆå¯ä»¥æ ¹æ®éœ€è¦æ›´ä¸¥æ ¼ï¼‰
- `style-src 'self' 'unsafe-inline'`ï¼šå…è®¸åŒæºæ ·å¼å’Œå†…è”æ ·å¼
- `img-src 'self' data: https:`ï¼šå…è®¸åŒæºå›¾ç‰‡ã€æ•°æ®URIå’ŒHTTPSå›¾ç‰‡
- `font-src 'self' data:`ï¼šå…è®¸åŒæºå­—ä½“å’Œæ•°æ®URI
- `connect-src 'self' https://api.vercel.app`ï¼šå…è®¸åŒæºå’ŒVercel APIçš„è¯·æ±‚
- `frame-ancestors 'self'`ï¼šåªå…è®¸åŒæºåµŒå…¥iframe
- `base-uri 'self'`ï¼šé™åˆ¶baseæ ‡ç­¾çš„URI
- `form-action 'self'`ï¼šé™åˆ¶è¡¨å•æäº¤ç›®æ ‡
- `object-src 'none'`ï¼šç¦æ­¢objectã€embedç­‰æ ‡ç­¾
- `upgrade-insecure-requests`ï¼šè‡ªåŠ¨å°†HTTPå‡çº§ä¸ºHTTPS

### å¦‚æœéœ€è¦æ›´ä¸¥æ ¼çš„CSP

å¯ä»¥ç§»é™¤ `'unsafe-inline'` å’Œ `'unsafe-eval'`ï¼Œä½†éœ€è¦ï¼š
1. å°†æ‰€æœ‰å†…è”è„šæœ¬æå–åˆ°å¤–éƒ¨æ–‡ä»¶
2. ä½¿ç”¨nonceæˆ–hashæ¥å…è®¸ç‰¹å®šçš„å†…è”è„šæœ¬
3. ç§»é™¤æ‰€æœ‰eval()è°ƒç”¨

## éƒ¨ç½²

ä¿®å¤å·²æ¨é€åˆ°GitHubï¼ŒVercelä¼šè‡ªåŠ¨éƒ¨ç½²ã€‚

### éªŒè¯ä¿®å¤

éƒ¨ç½²å®Œæˆåï¼ˆçº¦2-3åˆ†é’Ÿï¼‰ï¼š

1. **åˆ·æ–°ç½‘ç«™**
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+R æˆ– Cmd+Shift+Rï¼‰
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘å·¥å…·

2. **æ£€æŸ¥å®‰å…¨æŠ¥å‘Š**
   - æ‰“å¼€"é—®é¢˜"ï¼ˆIssuesï¼‰æ ‡ç­¾
   - æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰å®‰å…¨è­¦å‘Š

3. **æ£€æŸ¥å“åº”å¤´**
   - æ‰“å¼€"ç½‘ç»œ"ï¼ˆNetworkï¼‰æ ‡ç­¾
   - é€‰æ‹©ä»»æ„è¯·æ±‚
   - æŸ¥çœ‹å“åº”å¤´ï¼ˆResponse Headersï¼‰
   - åº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰å®‰å…¨å¤´éƒ¨

## é¢„æœŸç»“æœ

ä¿®å¤åï¼Œåº”è¯¥ï¼š

- âœ… **æ²¡æœ‰CSPé”™è¯¯**ï¼šæ‰€æœ‰èµ„æºéƒ½èƒ½æ­£å¸¸åŠ è½½
- âœ… **æ²¡æœ‰ç¼ºå°‘X-Content-Type-Optionsçš„é”™è¯¯**ï¼šæ‰€æœ‰èµ„æºéƒ½åŒ…å«è¿™ä¸ªå¤´éƒ¨
- âœ… **æ²¡æœ‰X-Powered-Byè­¦å‘Š**ï¼šæœåŠ¡å™¨ä¸å†æš´éœ²è¿™ä¸ªå¤´éƒ¨
- âœ… **æ²¡æœ‰Expiresè­¦å‘Š**ï¼šä½¿ç”¨Cache-Controlæ›¿ä»£
- âœ… **X-Frame-Optionsè­¦å‘Šå¯èƒ½ä¼šä¿ç•™**ï¼ˆä¸ºäº†å…¼å®¹æ€§ï¼‰ï¼Œä½†å®é™…ä½¿ç”¨çš„æ˜¯CSPçš„frame-ancestors

## æ³¨æ„äº‹é¡¹

1. **CSPå¯èƒ½ä¼šå½±å“åŠŸèƒ½**
   - å¦‚æœæŸäº›åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¯èƒ½éœ€è¦è°ƒæ•´CSPç­–ç•¥
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰CSPè¿è§„é”™è¯¯

2. **ç¼“å­˜æ§åˆ¶**
   - é™æ€èµ„æºç¼“å­˜1å°æ—¶ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
   - å¯¹äºAPIè¯·æ±‚ï¼Œå¯èƒ½éœ€è¦è®¾ç½®ä¸º `no-cache`

3. **ç»§ç»­ç›‘æ§**
   - å®šæœŸæ£€æŸ¥æµè§ˆå™¨å®‰å…¨æŠ¥å‘Š
   - ç¡®ä¿æ²¡æœ‰æ–°çš„å®‰å…¨é—®é¢˜

## æ€»ç»“

é€šè¿‡æ·»åŠ å®‰å…¨å¤´éƒ¨å’Œé…ç½®CSPï¼Œæˆ‘ä»¬ï¼š

1. âœ… **æé«˜äº†ç½‘ç«™å®‰å…¨æ€§**ï¼šé˜²æ­¢XSSã€ç‚¹å‡»åŠ«æŒç­‰æ”»å‡»
2. âœ… **ä¿®å¤äº†æµè§ˆå™¨è­¦å‘Š**ï¼šç¬¦åˆç°ä»£Webå®‰å…¨æ ‡å‡†
3. âœ… **æ”¹å–„äº†SEO**ï¼šæœç´¢å¼•æ“æ›´ä¿¡ä»»å®‰å…¨çš„ç½‘ç«™
4. âœ… **ä¿æŠ¤äº†ç”¨æˆ·éšç§**ï¼šé™åˆ¶äº†æ¨èäººä¿¡æ¯çš„æ³„éœ²

æ‰€æœ‰ä¿®å¤å·²éƒ¨ç½²ï¼Œç­‰å¾…Vercelè‡ªåŠ¨éƒ¨ç½²å®Œæˆåå³å¯ç”Ÿæ•ˆï¼


